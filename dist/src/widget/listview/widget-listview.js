/*
    Cornerstone Framework v0.9.1

    COPYRIGHT(C) 2012 BY SKTELECOM CO., LTD. ALL RIGHTS RESERVED.
    Released under the Apache License, Version 2.0
*/
!function(a,b){"function"==typeof define&&define.amd?define(["jquery","underscore","backbone","infinity"],b):a.ListView=b(a.$,a._,a.Backbone)}(window,function(a,b,c){var d,e,f,g="featuredListView",h=function(b,c){var g=this;f={$scroller:a(window),optimization:!0,SCROLL_THROTTLE:0,PAGE_TO_SCREEN_RATIO:3,scrollEndAction:function(){}},this.$el=a(b),this.options=c=a.extend(!0,f,c),infinity.config.SCROLL_THROTTLE=this.options.SCROLL_THROTTLE,infinity.config.PAGE_TO_SCREEN_RATIO=this.options.PAGE_TO_SCREEN_RATIO,d=infinity.ListView,e=infinity.ListItem,this.$el.each(function(){if(c.optimization){var b=g.$el.html();g.$el.html("");var e=new d(a(this));a(this).data("listView",e),g.$el.data("listView").append(b)}}),this.scrollHeight=navigator.userAgent.match(":*iPhone:*")&&!window.navigator.standalone?60:0;var h=0,i=function(){c.scrollEndAction(),g.$el.trigger("scrollEnd.cs.liveView")};c.$scroller.on("scroll",function(b){b.target.tagName?a(this)[0].scrollHeight-a(this).scrollTop()==a(this).outerHeight()&&i():(h=navigator.userAgent.match("Android")?a(window).scrollTop()+100:a(window).scrollTop(),h>=a(document).height()-a(window).height()-g.scrollHeight&&i())})};return h.prototype.addItem=function(b,c){b.optimization?this.$el.data("listView").append(a(c)):this.$el.append(c),this.$el.trigger("listView.addItem.done")},h.prototype.removeItem=function(b,c,d){var e,f,g,h,i,j=0;if(b.optimization){if("undefined"==typeof d)for(h=this.$el.data("listView").find(c),e=0,g=h.length;g>e;e++)h[e].remove();else for(h=this.$el.data("listView").find(c),e=0,g=h.length;g>e;e++){for(f in d)i=h[e].$el.find("[data-list-itemid='"+d[f]+"']"),j+=i.height(),i.remove();h[e].parent.height=h[e].parent.height-j}window.scrollTo(window.scrollX,window.scrollY-a(b.spinner).height())}else{if("undefined"==typeof d)c.remove();else for(e in d)c.find("[data-list-itemid='"+d[e]+"']").remove();window.scrollTo(window.scrollX,window.scrollY-a(b.spinner).height())}this.refresh(),this.$el.trigger("listView.removeItem.done")},h.prototype.refresh=function(){var b=this.$el.data("listView"),c=0;a(b.pages).each(function(){c+=this.height}),b.height=c,this.$el.children("div").css({height:b.height}),window.scrollTo(window.scrollX,window.scrollY-a(options.spinner).height())},h.prototype.scrollHandler=function(){this.$el.data("listView").scrollHandler()},a.fn[g]=function(b,c,d){return this.each(function(){var e=a(this),f=e.data(g);f||e.data(g,f=new h(this,b)),"string"==typeof b&&f[b](f.options,c,d)})},a.fn[g].Constructor=h,a(function(){a("[data-featured=listView]").each(function(){a(this)[g]()})}),c?c.View.extend({tagName:"ul",collectionItems:"items",initialize:function(){this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"reset",this.render)},addAll:function(){this.options.activeEmpty&&this.$el.empty(),this.collection.forEach(this.addOne,this)},addOne:function(b){b===this.collection.first()&&(this.$itemViewWrapper=a("<ul/>",{"class":"list-group"}));var c=this.options.itemView,d=new c({model:b});this.$itemViewWrapper.append(d.render().el),b===this.collection.last()&&this.$el.featuredListView("addItem",this.$itemViewWrapper)},render:function(){return this.addAll(),this.$el.featuredListView(this.options),this}}):h});