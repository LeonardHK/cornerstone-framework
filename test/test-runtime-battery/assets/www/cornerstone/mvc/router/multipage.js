define(["backbone","underscore","jquery","transition","jquery.hammer"],function(e,t,n,r){return e.Router.extend({constructor:function(i,s){var o=this;if(this.pages){var u=this.routes={};t.each(this.pages,function(e,i){i=="default"?e&&e.active&&(u["*path"]=i+"_handler"):e.fragment&&(t.isArray(e.fragment)||(e.fragment=[e.fragment]),t.each(e.fragment,function(e){u[e]=i+"_handler"})),e.el&&n(e.el).hide(),o[i+"_handler"]=function(){var t=arguments;o.runInactive(i);var s=o.currentPageId,u=o.currentPage;o.currentPageId=i,o.currentPage=e,o.runRender.apply(o,arguments);var a=o.findTransition(s,i);a?(a.inTarget.el=e.el,a.outTarget.el=u.el,a.done=function(){o.runActive.apply(o,t)},r.launcher(a)):(u&&u.el&&n(u.el).hide(),e.el&&n(e.el).show(),o.runActive.apply(o,arguments))}})}e.Router.apply(this,arguments)},findTransition:function(e,n){if(!this.transitions)return null;var r={inTarget:{},outTarget:{},isReverse:!1},i=this.transitions[e+":"+n];return i||(i=this.transitions[n+":"+e],r.isReverse=!0),i?(r.transitionType=t.isString(i)?i:i.type,i.duration&&(r.inTarget.duration=i.duration/2,r.outTarget.duration=i.duration/2),r):null},runRender:function(){if(!this.currentPage||!this.currentPage.render)return;var e=t.isFunction(this.currentPage.render)?this.currentPage.render:this[this.currentPage.render];t.isFunction(e)&&e.apply(this,arguments)},runActive:function(){if(!this.currentPage||!this.currentPage.active)return;var e=t.isFunction(this.currentPage.active)?this.currentPage.active:this[this.currentPage.active];t.isFunction(e)&&e.apply(this,arguments)},runInactive:function(e){if(!this.currentPage||!this.currentPage.inactive)return;var n=t.isFunction(this.currentPage.inactive)?this.currentPage.inactive:this[this.currentPage.inactive];t.isFunction(n)&&n(e)}})})