/*
    Cornerstone Framework v0.9.1

    COPYRIGHT(C) 2012 BY SKTELECOM CO., LTD. ALL RIGHTS RESERVED.
    Released under the Apache License, Version 2.0
*/
!function(){"use strict";var a,b,c=this,d="featuredChart",e=!0,f=function(a,b){this.el=a,this.$el=$(a),this.options=b,nv.dev=!1,this.render(b)};if(f.prototype={afterRender:function(a,b,c){this.$el.data("currentChart",c),this.$el.data("currentChartControl",b.control),this.util.removeClip(a),this.util.applyBindEvent(a,b,c)},render:function(b){var c=this,d=this.util.getTarget(d3.select(this.el),b);return d.$parent=this.$el,b.chartType.match(/.*bar3d.*/gi)?c[b.chartType+"Chart"](d,b):nv.addGraph(function(b,c,d){var f=d.color.length;a=b[d.chartType+"Chart"](c,d),a.tooltips(d.tooltips).color(function(a,b){return d.color[b%f]}),"line"===d.chartType&&e&&console.log(d),"pie"===d.chartType||("linePlusBar"===d.chartType?(a.xAxis.showMaxMin(d.showMaxMin).tickFormat(d3.format(d.format)),a.y1Axis.tickFormat(d3.format(d.format)),a.y2Axis.tickFormat(d3.format(d.format))):(a.xAxis.tickFormat(d3.format(d.format)).axisLabel(d.xAxisLabel),a.yAxis.tickFormat(d3.format(d.format)).axisLabel(d.yAxisLabel)));var g=d.beforeRender(c,d,a);a="function"==typeof g?g:a,c.attr("width",d.width).attr("height",d.height).datum(d.data).transition().duration(500).each("end",function(){$(b.el).trigger("shown"),e&&e&&console.log("shown")}).call(a),"function"==typeof a.afterRender&&a.afterRender("render"),a.multibar&&a.multibar.dispatch.on("animated",function(a){$(b.el).trigger("animationEnd",a)}),a.multibar&&a.multibar.dispatch.on("lastAnimated",function(a){$(b.el).trigger("complete",a),e&&console.log("complete",a),c.$parent.hasClass("overlay")&&c.$parent.removeClass("overlay")}),b.afterRender(c,d,a)}(c,d,b)),this},barChart:function(b,c){var d=this;return a=nv.models.multiBarChart(),a.showLegend(c.showLegend).showControls(c.showControls).controlsData(c.controlsData),a.afterRender=function(a){var e=this;if(!c.showValues)return!1;if(b.select(".nv-showValuesWrap").remove(),e.multibar&&e.multibar.stacked())return b.select(".nv-showValuesWrap").remove(),$(d.el).off("animationEnd._barChart"),!1;var f=b.select(".nv-barsWrap .nv-groups"),g=f.append("svg:g").attr("class","nv-showValuesWrap");g.style({opacity:1});var h=function(a,b){var d=d3.select(b.target),e=g.append("svg:text").attr("class","nv-value"),f=parseInt(d.attr("x"))+parseInt(d.attr("width"))/2,h=d.attr("y")-2,i=d.attr("width"),j=d.attr("height");return e.attr("x")!=f||e.attr("y")!=h||e.attr("width")!=i||e.attr("height")!=j?e.attr({opacity:0,x:f,y:h,width:i,height:j,"text-anchor":"middle",transform:d.attr("transform")}).transition().attr({opacity:1}).text(d3.format(c.format)(d.data()[0].y)):e.attr({opacity:1}),a};return d.util.removeClip(b),$(d.el).off("animationEnd._barChart").on("animationEnd._barChart",h),a},a},stackedBarChart:function(c,d){b=this,nv.addGraph(function(){return a=nv.models.multiBarChart().showControls(d.showControls).showLegend(d.showLegend).tooltips(d.tooltips),a.stacked(!0),c.datum(d.data).transition().duration(500).call(a),b.util.applyBindEvent(c,d,a,b.$el),a})},groupedBarChart:function(c,d){b=this,nv.addGraph(function(){return a=nv.models.multiBarChart().showControls(d.showControls).showLegend(d.showLegend).tooltips(d.tooltips),a.stacked(!1),c.datum(d.data).transition().duration(500).call(a),b.util.applyBindEvent(c,d,a,b.$el),a})},lineChart:function(b,c){return a=nv.models.lineChart().showLegend(c.showLegend)},pieChart:function(b,c){return a=nv.models.pieChart().showLegend(c.showLegend).tooltips(c.tooltips)},horizontalBarChart:function(b,c){return a=nv.models.multiBarHorizontalChart().showValues(c.showValues).showLegend(c.showLegend).valueFormat(d3.format(c.format)).tooltips(c.tooltips).controlsData(c.controlsData)},linePlusBarChart:function(){return a=nv.models.linePlusBarChart(),a.bars.forceY([0]),a},lineFocusChart:function(b,c){var d=this;return b.$parent.swipe(),a=nv.models.lineWithFocusChart(),a.xAxis.tickFormat(d3.format(c.format)),a.yAxis.tickFormat(d3.format(c.format)),a.y2Axis.tickFormat(d3.format(c.format)),a.afterRender=function(){function e(d){d=d?d:[0,99];var e=d3.svg.brush(),f=a.lines;if(!(Math.abs(d[0]-d[1])<=1)){a.dispatch.brush({extent:d,brush:e});var g=b.select(".nv-focus .nv-linesWrap").datum(c.data.filter(function(a){return!a.disabled}).map(function(a){return{key:a.key,values:a.values.filter(function(a,b){return f.x()(a,b)>=d[0]&&f.x()(a,b)<=d[1]})}}));return g.transition().call(f),b.select(".nv-focus .nv-x.nv-axis").transition().call(a.xAxis),b.select(".nv-focus .nv-y.nv-axis").transition().call(a.yAxis),d}}var f=a.x2Axis.scale().domain(),g=.1*f[1],h=[f[0],f[0]+g],i=function(a,b){var c,d,i=b.direction;return i.match(/left|right/gi)?("left"===i?(c=h[1],d=h[1]+g):"right"===i&&(c=h[0]-g,d=h[0]),c=f[0]>=c?f[0]:c,d=f[1]<=d?f[1]:d,d=c>d?c+g:d,h=[c,d],h=e(h),"undefined"==typeof h&&(h="left"===i?[f[1]-g,f[1]]:[f[0],f[0]+g]),a.preventDefault(),a.stopPropagation(),void 0):!1};b.$parent.off("swipe._chart").on("swipe._chart",i),d.util.removeClip(b)},a},bar3dChart:function(a,b){function c(a,b){b<a.length&&($(a[b].bar).css({height:a[b].height,"-webkit-transition":"all 0.8s ease-out"}),g=setTimeout(function(){b++,c(a,b),$(j.el).trigger("animationEnd"),a.length===b+1&&$(j.el).trigger("complete")},100))}function d(){$(j.el).trigger("shown"),j.util.applyBindEvent(a,b),$.each(k,function(a){$(k[a].bar).stop().css({height:0,"-webkit-transition":"none"})}),i="rotateX("+u+"deg) rotateY("+v+"deg)",q.css({"-webkit-transition":"none","-webkit-transform":i}),clearTimeout(g),clearTimeout(h),h=setTimeout(function(){i="rotateX("+w+"deg) rotateY("+x+"deg)",q.css({"-webkit-transform":i,"-webkit-transition":"all 2.8s ease-out"}),c(k,0)},500)}var e,f,g,h,i,j=this,k=[],l=$('<div class="figure"></div>'),m=$('<div class="graph"></div>'),n=$('<div class="bars"></div>'),o=$(b.data),p=o.length,q=a,r=!0,s=0,t=0,u=15,v=25,w=-20,x=$.isNumeric(b.endYRotation)?b.endYRotation:-15,y=45,z=52,A=z*p+12*o[0].values.length,B=z*p,C={chartData:function(){var a=[];return o.each(function(){$(this.values).each(function(){a.push(d3.format(b.format)(this.y))})}),a},chartHeading:function(){return b.title},chartLegend:function(){var a=[];return o.each(function(){a.push(this.key)}),a},chartYMax:function(){return 1e3*Math.ceil(Math.max.apply(Math,this.chartData())/1e3)},yLegend:function(){for(var a=this.chartYMax(),c=[],d=5,e=0;d>e;e++)c.unshift(d3.format(b.format)(a*e/(d-1)));return c},xLegend:function(){var a=[],c=0;return o.each(function(){this.values;var d=this.values.length;d>c&&$(this.values).each(function(){a.push(d3.format(b.format)(this.x))}),c=d}),a},columnGroups:function(){var a=[];return o.each(function(c){a[c]=$.map(this.values,function(a){return d3.format(b.format)(a.y)})}),a=j.util.transpose(a)}};e=C.chartYMax(),f=C.columnGroups(),$.each(f,function(a){for(var b=$('<div class="bar-group"></div>').css({width:B}),c=0,d=f[a].length;d>c;c++){var g={};g.label=this[c],g.height=Math.floor(100*(g.label/e))+"%",g.bar=$('<div class="bar fig'+c+'"><div class="face front"></div><div class="face back"></div><div class="face left"></div><div class="face right"></div><div class="face top"></div><div class="face bottom"></div><span>'+g.label+"</span></div>").css({left:z*c+"px"}).appendTo(b),k.push(g)}b.appendTo(n)});var D=C.chartHeading(),E=$("<h4>"+D+"</h4>");E.appendTo(l);var F=C.chartLegend(),G=$('<ul class="legend"></ul>');$.each(F,function(a){$('<li><span class="icon fig'+a+'"><div class="face front"></div><div class="face back"></div><div class="face left"></div><div class="face right"></div><div class="face top"></div><div class="face bottom"></div></span>'+this+"</li>").appendTo(G)}),G.appendTo(l);var H=C.xLegend(),I=$('<ul class="x-axis"></ul>').css({width:H.length*A});$.each(H,function(){$("<li><span>"+this+"</span></li>").css({width:B}).appendTo(I)}),I.appendTo(m);var J=C.yLegend(),K=$('<ul class="y-axis"></ul>').css({width:H.length*A});$.each(J,function(){$("<li><span>"+this+"</span></li>").appendTo(K)}),K.appendTo(m),n.css({width:H.length*A}).appendTo(m),a.css({width:H.length*A}),a.$parent.css({width:H.length*A-100}),m.appendTo(l),l.appendTo(q),$(document).keydown(function(){if(r){switch(event.keyCode){case 37:"bar3d"===b.chartType?t-=y:s-=y;break;case 38:"bar3d"===b.chartType?s+=y:t-=y;break;case 39:"bar3d"===b.chartType?t+=y:s+=y;break;case 40:"bar3d"===b.chartType?s-=y:t+=y}i="rotateX("+s+"deg) rotateY("+t+"deg)",q.css("-webkit-transform",i)}}),d()},horizontalBar3dChart:function(a,b){var c=a.closest(".widget-chart3d");!c.hasClass("widget-chart3d-hbar")&&c.addClass("widget-chart3d-hbar"),b.endYRotation=0,this.bar3dChart(a,b)},util:{transpose:function(a){var b=a.length?a.length:0,c=a[0]instanceof Array?a[0].length:0;if(0===c||0===b)return[];var d,e,f=[];for(d=0;c>d;d++)for(f[d]=[],e=0;b>e;e++)f[d][e]=a[e][d];return f},removeClip:function(a){var b=a.selectAll(".nv-groups");$(b[0]).each(function(){$(this).parent().attr("clip-path","")})},getTranslateJson:function(a){try{return JSON.parse(a.attr("transform").replace("translate(",'{"x":').replace(",",',"y":').replace(")","}"))}catch(b){return{x:0,y:0}}},getTarget:function(a,b){var c;return b.chartType.match(/bar3d.*/gi)?(0===$(a[0][0]).find(".bar3d").length&&$(a[0][0]).html($("<div/>",{"class":"wrapper"}).html($("<div/>",{"class":"bar3d"}))),a=$(a[0][0]).find(".bar3d"),!a.hasClass("chart")&&a.addClass("chart"),c=a.closest(".widget-chart"),!c.hasClass("widget-chart3d")&&c.addClass("widget-chart3d")):a=a.select("svg").length>0&&null===a.select("svg")[0][0]?a.append("svg:svg"):a.select("svg"),a},applyBindEvent:function(a,b,c){if(b.chartType.match(/.*bar3d/gi)){var d=function(){var c=a.closest(".widget-chart3d"),d=window.innerWidth/a.width();d=d>1?a.$parent.parent().width()/a.width():d,1>d?(c.css({marginBottom:1.2*-a.height()*(1-d),webkitTransform:"scale("+d+")"}),"horizontalBar3d"===b.chartType?c.find(".wrapper").css({webkitTransform:"scale(0.75) rotateZ(90deg) translateY("+.15*a.width()+"px)"}):c.find(".wrapper").css({marginLeft:.1*-a.width()}),c.css({width:.9*a.width()})):(c.removeAttr("style"),c.find(".wrapper").removeAttr("style"),c.css({width:a.width()}))};d(),$(window).off("resize._chart").on("resize._chart",function(){d()})}else{var f=function(b){e&&console.log("New State:",JSON.stringify(b)),!a.$parent.hasClass("overlay")&&a.$parent.addClass("overlay"),setTimeout(function(){"function"==typeof c.afterRender&&c.afterRender("stateChange"),"function"!=typeof c.multibar&&a.$parent.hasClass("overlay")&&a.$parent.removeClass("overlay")},10)};c.dispatch.stateChange&&c.dispatch.on("stateChange",f),!b.autoResize||nv.utils.windowResize(function(){c.update(),setTimeout(function(){"function"==typeof c.afterRender&&c.afterRender("resize")},10)})}}}},$.fn.featuredChart=function(a){var b={chartType:"bar",lineType:"basis",width:500,height:500,xAxisLabel:"X축",yAxisLabel:"Y축",format:".0f",data:{},showMaxMin:!0,showValues:!0,showControls:!0,showLegend:!0,tooltips:!0,title:"",color:["#2c3e50","#e74c3c","#3498db","#f5a503","#7c569f","#75483e","#bf64a3","#6b6b6b"],controlsData:{groupedName:"그룹",stackedName:"스택"},autoResize:!0,beforeRender:function(a,b,c){return c}};return a=$.extend(!0,b,a),this.each(function(){var b=$(this),c=b.data(d);"string"==typeof a?c[a](c.options):"object"==typeof a&&"object"==typeof c?c.render(a):(c=new f(this,a),b.data(d,c))})},$.fn.featuredChart.Constructor=f,c.Cornerstone=c.Cornerstone||{},c.Cornerstone.widget=c.Cornerstone.widget||{},c.Cornerstone.widget.activeDataApi=function(a){a=a&&a.length?a.find("[data-featured=chart]"):$("[data-featured=chart]"),a.each(function(){var a=this,b=$(this).data("chartBind");b&&$.getJSON(b).success(function(b){$(a)[d]({chartType:$(a).data("chartType"),format:$(a).data("chartFormat"),data:b})})})},$(function(){c.Cornerstone.widget.activeDataApi()}),"function"==typeof c.define&&c.define.amd){var g=c.define;g(["jquery","underscore","backbone","d3","nv"],function(a,b,c){return c.View.extend({model:new c.Model,initialize:function(){b.bindAll(this,"render")},updateChart:function(b){b.model.clear(),b.model.fetch({success:function(c){var d=[];a.each(c.toJSON(),function(a,b){d.push(b)}),b.options.chartOptions=a.extend({},b.options.chartOptions,{data:d}),b.$el.featuredChart(b.options.chartOptions)}})},render:function(){return this.updateChart(this),this}})})}}.call(this);