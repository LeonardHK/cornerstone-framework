/*
 *  Project: SKT HTML5 Framework
 *  CodeName : CornerStone
 *  FileName : featured-chart.js
 *  Description: D3 chart를 jQuery 플러그인 형태로 사용 할 수 있고, 반응형 웹에 맞는 화면을 보여주도록 구현함.
 *  Author: 김우섭
 *  License :
 */(function(e,t,n,r,i,s){"use strict";typeof n=="object"&&typeof r=="function"&&r.amd?r(["backbone","underscore","jquery"],function(n,r,o){s(o,e,t,i);return n.View.extend({model:new n.Model,initialize:function(){r.bindAll(this,"render")},updateChart:function(e){e.model.clear();e.model.fetch({success:function(t){var n=[];o.each(t.toJSON(),function(e,t){n.push(t)});e.options=o.extend({},e.options,{data:n});e.$el.featuredChart(e.options)}})},render:function(){this.$el.featuredChart(this.options);this.updateChart(this);return this}})}):s(e.jQuery,e,t,e.d3)})(window,document,Cornerstone,define,d3,function(e,t,n,r,i){function a(t,n){var i=this,s=r.select(t);typeof n=="object"&&typeof n.color=="object"&&n.color.length>0&&(n.color=r.scale.ordinal().range(n.color));this.options=n;this.$el=e(t);nv.dev=!1;this[n.chartType+"Chart"](s,n)}var s="featuredChart",o,u;a.name="FeaturedChart";a.prototype.barChart=function(e,t){nv.addGraph(function(){var n=nv.models.multiBarChart();n.xAxis.axisLabel(t.xAxisLabel).tickFormat(r.format(",f"));n.yAxis.axisLabel(t.yAxisLabel).tickFormat(r.format(",.1f"));n.color(t.color.range());e.select("svg").length>0&&e.select("svg")[0][0]===null?e=e.append("svg:svg"):e=e.select("svg");e.datum(t.data).transition().duration(500).call(n);!t.autoResize||nv.utils.windowResize(n.update);return n})};a.prototype.stackedBarChart=function(e,t){nv.addGraph(function(){var n=nv.models.multiBarChart();n.stacked(!0);n.xAxis.axisLabel(t.xAxisLabel).tickFormat(r.format(",f"));n.yAxis.axisLabel(t.yAxisLabel).tickFormat(r.format(",.1f"));n.color(t.color.range());e.select("svg").length>0&&e.select("svg")[0][0]===null?e=e.append("svg:svg"):e=e.select("svg");e.datum(t.data).transition().duration(500).call(n);!t.autoResize||nv.utils.windowResize(n.update);return n})};a.prototype.groupedBarChart=function(e,t){nv.addGraph(function(){var n=nv.models.multiBarChart();n.stacked(!1);n.xAxis.axisLabel(t.xAxisLabel).tickFormat(r.format(",f"));n.yAxis.axisLabel(t.yAxisLabel).tickFormat(r.format(",.1f"));n.color(t.color.range());e.select("svg").length>0&&e.select("svg")[0][0]===null?e=e.append("svg:svg"):e=e.select("svg");e.datum(t.data).transition().duration(500).call(n);!t.autoResize||nv.utils.windowResize(n.update);return n})};a.prototype.lineChart=function(e,t){nv.addGraph(function(){var n=nv.models.lineChart();n.xAxis.axisLabel(t.xAxisLabel).tickFormat(r.format(",f"));n.yAxis.axisLabel(t.yAxisLabel).tickFormat(r.format(",.1f"));n.color(t.color.range());e.select("svg").length>0&&e.select("svg")[0][0]===null?e=e.append("svg:svg"):e=e.select("svg");e.datum(t.data).transition().duration(500).call(n);!t.autoResize||nv.utils.windowResize(n.update);return n})};a.prototype.cumulativeLineChart=function(e,t){function s(e){nv.addGraph(function(){i=nv.models.cumulativeLineChart().x(function(e){return e.x}).y(function(e){return e.y/100}).color(t.color.range());i.xAxis.axisLabel(t.xAxisLabel).tickFormat(function(e){return r.time.format("%x")(new Date(e))});i.yAxis.axisLabel(t.yAxisLabel).tickFormat(r.format(",.1%"));e.select("svg").length>0&&e.select("svg")[0][0]===null?e=e.append("svg:svg"):e=e.select("svg");e.datum(n).transition().duration(500).call(i);!t.autoResize||nv.utils.windowResize(i.update);return i})}function o(){var e=[],t=new Date(2012,1,1,0,0,0,0);for(var n=0;n<30;n++){e.push({x:new Date(t.getTime()),y:Math.random()*100});t.setDate(t.getDate()+1)}return e}var n=[{key:"Long",values:o()}],i,u=!1;this.$el.on("mouseover",function(){u=!0}).on("mouseout",function(){u=!1});setInterval(function(){var t=n[0].values,r=new Date(t[t.length-1].x);r.setDate(r.getDate()+1);t.shift();t.push({x:r.getTime(),y:Math.random()*100});u||s(e)},1500)};a.prototype.pieChart=function(t,n){var r=500,i=500;nv.addGraph(function(){var s=nv.models.pieChart().x(function(e){return e.key}).y(function(e){return e.y}).values(function(e){return e}).color(n.color.range());t.select("svg").length>0&&t.select("svg")[0][0]===null?t=t.append("svg:svg"):t=t.select("svg");t.datum([n.data]).transition().duration(1200).attr("width",r).attr("height",i).call(s);e.each(t.selectAll(".nv-slice > .nv-label > text")[0],function(t,n){e(n).removeAttr("style")});!n.autoResize||nv.utils.windowResize(s.update);return s})};a.prototype.scatterChart=function(e,t){nv.addGraph(function(){var n=nv.models.scatterChart().showDistX(!0).showDistY(!0).color(r.scale.category10().range());n.xAxis.axisLabel(t.xAxisLabel).tickFormat(r.format(",f"));n.yAxis.axisLabel(t.yAxisLabel).tickFormat(r.format(",.1f"));e.append("svg:svg").datum(t.data).transition().duration(500).call(n);!t.autoResize||nv.utils.windowResize(n.update);return n})};e.fn.featuredChart=function(t,n){u={chartType:"bar",lineType:"basis",xAxisLabel:null,yAxisLabel:null,width:960,height:600,margin:[0,0,0,0],padding:[0,0,0,0],data:{},animate:!1,controlBar:!1,filtering:!0,autoResize:!0,color:r.scale.category10()};t=e.extend(!0,u,t);return this.each(function(){var n=e(this),r=n.data(s);if(typeof t=="string")r[t](r.options);else{r=new a(this,t);n.data(s,r)}t.filtering?n.addClass("filtering"):n.removeClass("filtering");t.controlBar?n.addClass("control-bar"):n.removeClass("control-bar")})};e.fn.featuredChart.Constructor=a;e(function(){e("[data-featured=chart]").each(function(){var t=this,n=e(this).data("chartBind");e.getJSON(n).success(function(n){e(t)[s]({chartType:e(t).data("chartType"),data:n})}).error(function(e,t,n){console.log("getJSON Error",e,t,n)})})});return a});