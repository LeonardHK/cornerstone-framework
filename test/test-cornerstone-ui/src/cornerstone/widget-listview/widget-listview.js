/*
    Cornerstone Framework v0.9.1

    COPYRIGHT(C) 2012 BY SKTELECOM CO., LTD. ALL RIGHTS RESERVED.
    Released under the Apache License, Version 2.0
*/
!function(a,b,c){"function"==typeof define&&define.amd?define(["backbone","underscore","jquery"],function(d,e,f){return c(f,a,b),d.View.extend({tagName:"ul",initialize:function(){e.bindAll(this,"render")},addItem:function(a,b){var c=document.createElement(this.tagName);b.each(function(b){f(c).append(new a.options.itemView({model:b}).render().el)}),a.$el.featuredListView("addItem",c)},removeItem:function(a,b){return this.$el.featuredListView("removeItem",a,b)},updateListView:function(a){a.collection.fetch({success:function(b){a.addItem(a,b)}})},render:function(){return this.$el.featuredListView(this.options),this.updateListView(this),this}})}):c(a.jQuery,a,b)}(this,document,function(a,b,c){var d,e,f,g="featuredListView",h=function(g,h){var i=this;f={$scroller:a(b),optimization:!0,SCROLL_THROTTLE:0,scrollEndAction:function(){}},this.$el=a(g),this.options=h=a.extend(!0,f,h),infinity.config.SCROLL_THROTTLE=this.options.SCROLL_THROTTLE,d=infinity.ListView,e=infinity.ListItem,this.$el.each(function(){if(h.optimization){var b=i.$el.html();i.$el.html("");var c=new d(a(this));a(this).data("listView",c),i.$el.data("listView").append(b),b=""}}),this.scrollHeight=navigator.userAgent.match(":*iPhone:*")&&!b.navigator.standalone?60:0;var j=0;h.$scroller.on("scroll",function(d){d.target.tagName?a(this)[0].scrollHeight-a(this).scrollTop()==a(this).outerHeight()&&(h.scrollEndAction(),console.log("nested",i.$el),i.$el.trigger("scrollEnd.cs.liveView")):(j=navigator.userAgent.match("Android")?a(b).scrollTop()+100:a(b).scrollTop(),j>=a(c).height()-a(b).height()-i.scrollHeight&&(h.scrollEndAction(),console.log("window",i.$el),i.$el.trigger("scrollEnd.cs.liveView")))})};return h.prototype.addItem=function(b,c){b.optimization?this.$el.data("listView").append(a(c)):this.$el.append(c),this.$el.trigger("listView.addItem.done")},h.prototype.removeItem=function(c,d,e){var f,g,h,i,j,k=0;if(c.optimization){if("undefined"==typeof e)for(i=this.$el.data("listView").find(d),f=0,h=i.length;h>f;f++)i[f].remove();else for(i=this.$el.data("listView").find(d),f=0,h=i.length;h>f;f++){for(g in e)j=i[f].$el.find("[data-list-itemid='"+e[g]+"']"),k+=j.height(),j.remove();i[f].parent.height=i[f].parent.height-k}b.scrollTo(b.scrollX,b.scrollY-a(c.spinner).height())}else{if("undefined"==typeof e)d.remove();else for(f in e)d.find("[data-list-itemid='"+e[f]+"']").remove();b.scrollTo(b.scrollX,b.scrollY-a(c.spinner).height())}this.refresh(),this.$el.trigger("listView.removeItem.done")},h.prototype.refresh=function(){var c=this.$el.data("listView"),d=0;a(c.pages).each(function(){d+=this.height}),c.height=d,this.$el.children("div").css({height:c.height}),b.scrollTo(b.scrollX,b.scrollY-a(options.spinner).height())},h.prototype.scrollHandler=function(){this.$el.data("listView").scrollHandler()},a.fn[g]=function(b,c,d){return this.each(function(){var e=a(this),f=e.data(g);f||e.data(g,f=new h(this,b)),"string"==typeof b&&f[b](f.options,c,d)})},a.fn[g].Constructor=h,a(function(){a("[data-featured=listView]").each(function(){a(this)[g]()})}),h});