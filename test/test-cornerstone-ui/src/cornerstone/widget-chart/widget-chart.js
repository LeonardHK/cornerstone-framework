/*
    Cornerstone Framework v0.9.1

    COPYRIGHT(C) 2012 BY SKTELECOM CO., LTD. ALL RIGHTS RESERVED.
    Released under the Apache License, Version 2.0
*/
!function(){"use strict";var a,b,c=this,d="featuredChart",e=function(a,b){this.el=a,this.$el=$(a),this.options=b,nv.dev=!1,this.render(b)};if(e.prototype={afterRender:function(a,b,c){this.$el.data("currentChart",c),this.$el.data("currentChartControl",b.control),this.util.applyBindEvent(a,b,c,this.$el),a.on("stateChange",function(a){console.log(a)})},render:function(b){var c=this,d=this.util.getTarget(d3.select(this.el));nv.addGraph(function(b,c,d){var e=d.color.length;a=b[d.chartType+"Chart"](c,d),a.tooltips(d.tooltips).color(function(a,b){return d.color[b%e]}),"line"===d.chartType&&a.lines.color(d.data.map(function(a,b){return a.color||d.color[b%e]})),"pie"===d.chartType||("linePlusBar"===d.chartType?(a.xAxis.showMaxMin(d.showMaxMin).tickFormat(d3.format(d.format)),a.y1Axis.tickFormat(d3.format(d.format)),a.y2Axis.tickFormat(d3.format(d.format))):(a.xAxis.tickFormat(d3.format(d.format)).axisLabel(d.xAxisLabel),a.yAxis.tickFormat(d3.format(d.format)).axisLabel(d.yAxisLabel))),a=d.beforeRender(c,d,a),c.attr("width",d.width).attr("height",d.height).datum(d.data).transition().duration(500).each("end",function(){$(b.el).trigger("shown")}).call(a),"function"==typeof a.afterRender&&a.afterRender("render"),a.multibar&&a.multibar.dispatch.on("animated",function(a){$(b.el).trigger("animationEnd",a)}),a.multibar&&a.multibar.dispatch.on("lastAnimated",function(a){$(b.el).trigger("complete",a)}),b.afterRender(c,d,a)}(c,d,b))},barChart:function(b,c){var d=this;return a=nv.models.multiBarChart(),a.showLegend(c.showLegend).showControls(c.showControls).controlsData(c.controlsData),a.afterRender=function(e){if(!c.showValues)return!1;if(b.select(".nv-showValuesWrap").remove(),a.multibar&&a.multibar.stacked())return b.select(".nv-showValuesWrap").remove(),!1;var f=b.select(".nv-barsWrap .nv-groups"),g=f.append("svg:g").attr("class","nv-showValuesWrap");f[0][0].parentNode.setAttribute("clip-path",""),g.style({opacity:1});var h=function(a,b){var d=d3.select(b.target),e=g.append("svg:text").attr("class","nv-value"),f=parseInt(d.attr("x"))+parseInt(d.attr("width"))/2,h=d.attr("y")-2,i=d.attr("width"),j=d.attr("height");return e.attr("x")!=f||e.attr("y")!=h||e.attr("width")!=i||e.attr("height")!=j||"update"===status?e.attr({opacity:0,x:f,y:h,width:i,height:j,"text-anchor":"middle",transform:d.attr("transform")}).transition().attr({opacity:1}).text(d3.format(c.format)(d.data()[0].y)):e.attr({opacity:1}),a};return $(d.el).off("animationEnd._barChart").on("animationEnd._barChart",h),e},a},stackedBarChart:function(c,d){b=this,nv.addGraph(function(){return a=nv.models.multiBarChart().showControls(d.showControls).showLegend(d.showLegend).tooltips(d.tooltips),a.stacked(!0),c.datum(d.data).transition().duration(500).call(a),b.util.applyBindEvent(c,d,a,b.$el),a})},groupedBarChart:function(c,d){b=this,nv.addGraph(function(){return a=nv.models.multiBarChart().showControls(d.showControls).showLegend(d.showLegend).tooltips(d.tooltips),a.stacked(!1),c.datum(d.data).transition().duration(500).call(a),b.util.applyBindEvent(c,d,a,b.$el),a})},lineChart:function(b,c){return a=nv.models.lineChart().showLegend(c.showLegend)},pieChart:function(b,c){return a=nv.models.pieChart().showLegend(c.showLegend).tooltips(c.tooltips)},horizontalBarChart:function(b,c){return a=nv.models.multiBarHorizontalChart().showValues(c.showValues).showLegend(c.showLegend).valueFormat(d3.format(c.format)).tooltips(c.tooltips).controlsData(c.controlsData)},linePlusBarChart:function(){return a=nv.models.linePlusBarChart(),a.bars.forceY([0]),a},lineFocusChart:function(c){function d(){return e(3,10+200*Math.random(),.1).map(function(a,b){return{key:"Stream"+b,values:a}})}function e(a,b,c){function d(a){for(var c=1/(.1+Math.random()),d=2*Math.random()-.5,e=10/(.1+Math.random()),f=0;b>f;f++){var g=(f/b-d)*e;a[f]+=c*Math.exp(-g*g)}}return arguments.length<3&&(c=0),d3.range(a).map(function(){var a,e=[];for(a=0;b>a;a++)e[a]=c+c*Math.random();for(a=0;5>a;a++)d(e);return e.map(f)})}function f(a,b){return{x:b,y:Math.max(0,a)}}b=this,nv.addGraph(function(){return a=nv.models.lineWithFocusChart(),a.xAxis.tickFormat(d3.format(",f")),a.yAxis.tickFormat(d3.format(",.2f")),a.y2Axis.tickFormat(d3.format(",.2f")),c=b.util.getTarget(c),c.datum(d()).transition().duration(500).call(a),a})},util:{getTranslateJson:function(a){try{return JSON.parse(a.attr("transform").replace("translate(",'{"x":').replace(",",',"y":').replace(")","}"))}catch(b){return{x:0,y:0}}},getTarget:function(a){return a=a.select("svg").length>0&&null===a.select("svg")[0][0]?a.append("svg:svg"):a.select("svg")},applyBindEvent:function(a,b,c){c.dispatch.on("stateChange",function(){setTimeout(function(){"function"==typeof c.afterRender&&c.afterRender("stateChange")},0)}),!b.autoResize||nv.utils.windowResize(function(){c.update(),setTimeout(function(){"function"==typeof c.afterRender&&c.afterRender("resize")},0)})}}},$.fn.featuredChart=function(a){var b={chartType:"bar",lineType:"basis",width:500,height:500,xAxisLabel:"X축",yAxisLabel:"Y축",format:".0f",data:{},showMaxMin:!0,showValues:!0,showControls:!0,showLegend:!0,tooltips:!0,color:["#2c3e50","#e74c3c","#3498db","#f5a503","#7c569f","#75483e","#bf64a3","#6b6b6b"],controlsData:{groupedName:"그룹",stackedName:"스택"},autoResize:!0,beforeRender:function(a,b,c){return c}};return a=$.extend(!0,b,a),this.each(function(){var b=$(this),c=b.data(d);"string"==typeof a?c[a](c.options):"object"==typeof a&&"object"==typeof c?c.render(a):(c=new e(this,a),b.data(d,c))})},$.fn.featuredChart.Constructor=e,c.Cornerstone=c.Cornerstone||{},c.Cornerstone.widget=c.Cornerstone.widget||{},c.Cornerstone.widget.activeDataApi=function(a){a=a&&a.length?a.find("[data-featured=chart]"):$("[data-featured=chart]"),a.each(function(){var a=this,b=$(this).data("chartBind");b&&$.getJSON(b).success(function(b){$(a)[d]({chartType:$(a).data("chartType"),format:$(a).data("chartFormat"),data:b})})})},$(function(){c.Cornerstone.widget.activeDataApi()}),"function"==typeof c.define&&c.define.amd){var f=c.define;f(["jquery","underscore","backbone","d3","nv"],function(a,b,c){return c.View.extend({model:new c.Model,initialize:function(){b.bindAll(this,"render")},updateChart:function(b){b.model.clear(),b.model.fetch({success:function(c){var d=[];a.each(c.toJSON(),function(a,b){d.push(b)}),b.options.chartOptions=a.extend({},b.options.chartOptions,{data:d}),b.$el.featuredChart(b.options.chartOptions)}})},render:function(){return this.updateChart(this),this}})})}}.call(this);